{{- include "gluon.wait.wait-job-configmap.overrides" (list . "gluon-wait.wait-configmap") }}
{{- define "gluon-wait.wait-configmap" }}
{{- end }}
---
{{ include "gluon.wait.wait-job.overrides" (list . "gluon-wait.wait-job") }}
{{- define "gluon-wait.wait-job" }}
metadata:
  name: {{ .Release.Name }}-wait-job
spec:
  template:
    metadata:
      labels:
        app.kubernetes.io/name: {{ .Release.Name }}-wait-job
    spec:
      serviceAccountName: {{ .Release.Name }}-wait-job-sa
{{- end }}
---
{{ include "gluon.wait.wait-job-sa.overrides" (list . "gluon-wait.wait-job-sa") }}
{{- define "gluon-wait.wait-job-sa" }}
metadata:
  name: {{ .Release.Name }}-wait-job-sa
{{- end }}
---
{{ include "gluon.wait.wait-job-role.overrides" (list . "gluon-wait.wait-job-role") }}
{{- define "gluon-wait.wait-job-role" }}
{{- end }}
---
{{ include "gluon.wait.wait-job-role.overrides" (list . "gluon-wait-istiod.wait-job-role") }}
{{- define "gluon-wait-istiod.wait-job-role" }}
metadata:
  name: {{ .Release.Name }}-istiod-wait-job-role
  namespace: istio-system
{{- end }}
---
{{ include "gluon.wait.wait-job-rolebinding.overrides" (list . "gluon-wait.wait-job-rolebinding") }}
{{- define "gluon-wait.wait-job-rolebinding" }}
metadata:
  name: {{ .Release.Name }}-wait-job-rolebinding
subjects:
- kind: ServiceAccount
  name: {{ .Release.Name }}-wait-job-sa
  namespace: {{ .Release.Namespace }}
{{- end }}
---
{{ include "gluon.wait.wait-job-rolebinding.overrides" (list . "gluon-wait-istiod.wait-job-rolebinding") }}
{{- define "gluon-wait-istiod.wait-job-rolebinding" }}
metadata:
  name: {{ .Release.Name }}-istiod-wait-job-rolebinding
  namespace: istio-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: {{ .Release.Name }}-istiod-wait-job-role
subjects:
- kind: ServiceAccount
  name: {{ .Release.Name }}-wait-job-sa
  namespace: {{ .Release.Namespace }}
{{- end }}